@using wppCms.Areas.Usr.Models
@model UsrHomeIndexViewModel

@{
    ViewData["Title"] = "Workspace";
    ViewData["FontAwsome"] = Model.FontAwsomeUrl;
    ViewData["Culture"] = Model.Culture;

    Layout = "~/Areas/Usr/Views/Shared/_Layout.cshtml";
}

<div class="container my-5">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb small">
            <li class="breadcrumb-item">
                <a href="/@Model.Culture/usr/organizations">
                    <i class="bi bi-building me-1"></i>Organizations
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                Channels
            </li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="fw-bold mb-1">
                <i class="bi bi-collection me-2"></i>
                Channels
            </h1>
            <p class="text-muted mb-0">
                Channels organize content and communication within your organization.
            </p>
        </div>

        <div>
            <button type="button"
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#addChannelModal">
                <i class="bi bi-plus-circle me-1"></i>
                New Channel
            </button>
        </div>
    </div>

    <!-- Search -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text"
                       class="form-control"
                       id="searchInput"
                       onkeyup="searchTable()"
                       placeholder="Search channels by name or permalink">
            </div>
        </div>
    </div>

    <!-- Channel List -->
    <div class="card border">
        <div class="card-body p-0">
            <table class="table mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Display Name</th>
                        <th>Perma Name</th>
                        <th class="text-end">Articles</th>
                    </tr>
                </thead>
                <tbody id="channelTableBody">
                    @if (Model.Channels.Items.Any())
                    {
                        foreach (var channelViewModel in Model.Channels.Items)
                        {
                            <tr>
                                <td class="fw-semibold">
                                    @channelViewModel.Channel.Title
                                </td>
                                <td>
                                    <a href="/@Model.Culture/usr/channel/@channelViewModel.Channel.Id"
                                       class="text-decoration-none">
                                        <i class="bi bi-link-45deg me-1"></i>
                                        @channelViewModel.Channel.PermaName
                                    </a>
                                </td>
                                <td class="text-end text-muted">
                                    @channelViewModel.Channel.ArticleCount.ToString("N0")
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="3" class="text-center text-muted py-4">
                                No channels found.
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal: Add Channel -->
<div class="modal fade"
     id="addChannelModal"
     tabindex="-1"
     aria-labelledby="addChannelModalLabel"
     aria-hidden="true">

    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="addChannelModalLabel">
                    <i class="bi bi-plus-circle me-1"></i>
                    Add New Channel
                </h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form action="/@Model.Culture/usr/channel/add" method="post">

                    <div class="mb-3">
                        <label class="form-label">Channel Name</label>
                        <input type="text"
                               class="form-control"
                               name="Title"
                               required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">PermaName</label>
                        <input type="text"
                               class="form-control"
                               name="PermaName"
                               required
                               pattern="[a-z0-9\-]+"
                               title="Lowercase letters, numbers and hyphens only">
                        <div class="form-text">
                            Used in URLs. Cannot be changed later.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control"
                                  name="Description"
                                  rows="3"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Default Culture</label>
                        <input type="text"
                               class="form-control"
                               name="DefaultCulture"
                               required>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input"
                               type="checkbox"
                               name="IsPublic"
                               id="isPublic">
                        <label class="form-check-label" for="isPublic">
                            Make channel public
                        </label>
                    </div>

                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">
                            Create Channel
                        </button>
                    </div>

                </form>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        function searchTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const rows = document.getElementById("channelTableBody").getElementsByTagName("tr");

            for (let i = 0; i < rows.length; i++) {
                let match = false;
                const cells = rows[i].getElementsByTagName("td");

                for (let j = 0; j < cells.length; j++) {
                    if (cells[j] && cells[j].innerText.toLowerCase().includes(filter)) {
                        match = true;
                        break;
                    }
                }
                rows[i].style.display = match ? "" : "none";
            }
        }
    </script>
}
